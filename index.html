<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç£ç©ºæ°£å“è³ªå³æ™‚çœ‹æ¿ (AQI)</title>
    <style>
        body { font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; color: #333; padding: 20px; }
        h1 { text-align: center; color: #2c3e50; }
        
        /* æ§åˆ¶å€ */
        .controls { text-align: center; margin-bottom: 30px; }
        select { padding: 10px 15px; font-size: 16px; border-radius: 5px; border: 1px solid #ddd; }
        button { padding: 10px 20px; font-size: 16px; background-color: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background-color: #2980b9; }

        /* å¡ç‰‡ç¶²æ ¼ */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        
        /* ç©ºæ°£å“è³ªå¡ç‰‡ */
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); }
        .card h3 { margin: 0 0 10px 0; font-size: 1.2em; }
        .aqi-value { font-size: 2.5em; font-weight: bold; margin: 10px 0; }
        .status { font-weight: bold; padding: 5px 10px; border-radius: 15px; color: white; display: inline-block; }
        .time { font-size: 0.8em; color: #777; margin-top: 10px; }

        /* AQI é¡è‰²å®šç¾© */
        .aqi-good { background-color: #009866; } /* 0-50 */
        .aqi-moderate { background-color: #FFDE33; color: #333 !important; } /* 51-100 */
        .aqi-sensitive { background-color: #FF9933; } /* 101-150 */
        .aqi-unhealthy { background-color: #CC0033; } /* 151-200 */
        .aqi-very-unhealthy { background-color: #660099; } /* 201-300 */
        .aqi-hazardous { background-color: #7E0023; } /* 301+ */
    </style>
</head>
<body>

    <h1>ğŸ‡¹ğŸ‡¼ å°ç£ç©ºæ°£å“è³ªå³æ™‚çœ‹æ¿</h1>
    
    <div class="controls">
        <label for="countySelect">é¸æ“‡ç¸£å¸‚ï¼š</label>
        <select id="countySelect">
            <option value="all">å…¨å°ç£</option>
        </select>
        <button onclick="fetchData()">é‡æ–°æ•´ç†</button>
    </div>

    <div id="loading" style="text-align:center;">è¼‰å…¥ä¸­...</div>
    <div id="dashboard" class="grid"></div>

    <script>
        // *** é‡è¦ï¼šè«‹åœ¨æ­¤è™•å¡«å…¥æ‚¨çš„ç’°å¢ƒéƒ¨ API Key ***
        // å¦‚æœæ²’æœ‰ Keyï¼Œæ‚¨å¯ä»¥å» https://data.moenv.gov.tw/ ç”³è«‹
        // ç‚ºäº†æ¼”ç¤ºï¼Œæˆ‘å€‘ä½¿ç”¨å…¬é–‹æ¸¬è©¦é€£çµï¼Œè‹¥å¤±æ•ˆè«‹è‡ªè¡Œæ›¿æ› Key
        const API_KEY = " d62dcdf1-adf6-49dd-9c9c-b65b1556323d"; // ç•™ç©ºæ™‚ï¼Œè…³æœ¬æœƒå˜—è©¦ä½¿ç”¨ç„¡ Key çš„å…¬é–‹é™åˆ¶é¡åº¦æˆ–æé†’
        
        const API_URL = `https://data.moenv.gov.tw/api/v2/aqx_p_432?language=zh&api_key=${API_KEY}`;

        let allData = [];

        async function fetchData() {
            const dashboard = document.getElementById('dashboard');
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            dashboard.innerHTML = '';

            try {
                // å¦‚æœæ‚¨æ²’æœ‰å¡«å…¥ API Keyï¼Œé€™å€‹è«‹æ±‚å¯èƒ½æœƒå› ç‚ºæ¬¡æ•¸é™åˆ¶è€Œå¤±æ•—
                const res = await fetch(API_URL);
                if (!res.ok) throw new Error("API è«‹æ±‚å¤±æ•—ï¼Œè«‹æª¢æŸ¥ API Key");
                
                const json = await res.json();
                allData = json.records;
                
                populateCounties();
                renderData(allData);
                loading.style.display = 'none';

            } catch (error) {
                loading.innerHTML = `<span style="color:red">è®€å–å¤±æ•—ï¼š${error.message}<br>è«‹ç¢ºèªæ‚¨æ˜¯å¦æœ‰æœ‰æ•ˆçš„ç’°å¢ƒéƒ¨ API Keyã€‚</span>`;
                console.error(error);
            }
        }

        function getAQIClass(aqi) {
            if (aqi <= 50) return 'aqi-good';
            if (aqi <= 100) return 'aqi-moderate';
            if (aqi <= 150) return 'aqi-sensitive';
            if (aqi <= 200) return 'aqi-unhealthy';
            if (aqi <= 300) return 'aqi-very-unhealthy';
            return 'aqi-hazardous';
        }

        function renderData(data) {
            const dashboard = document.getElementById('dashboard');
            dashboard.innerHTML = '';

            data.forEach(site => {
                const aqi = parseInt(site.aqi);
                const statusClass = getAQIClass(aqi);
                
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>${site.sitename} <span style="font-size:0.6em; color:#666">(${site.county})</span></h3>
                    <div class="aqi-value" style="color:${aqi <= 100 && aqi > 50 ? '#d4b106' : 'inherit'}">${site.aqi}</div>
                    <div class="status ${statusClass}">${site.status}</div>
                    <div class="time">æ›´æ–°ï¼š${site.publishtime}</div>
                    <div style="margin-top:5px; font-size:0.9em;">PM2.5: ${site['pm2.5']}</div>
                `;
                dashboard.appendChild(card);
            });
        }

        function populateCounties() {
            const select = document.getElementById('countySelect');
            // åªåœ¨ç¬¬ä¸€æ¬¡è¼‰å…¥æ™‚å¡«å……é¸é …ï¼Œé¿å…é‡ç½®
            if (select.options.length > 1) return;

            const counties = [...new Set(allData.map(item => item.county))];
            counties.forEach(county => {
                const option = document.createElement('option');
                option.value = county;
                option.innerText = county;
                select.appendChild(option);
            });
        }

        // ç›£è½ç¸£å¸‚ç¯©é¸
        document.getElementById('countySelect').addEventListener('change', (e) => {
            const selected = e.target.value;
            if (selected === 'all') {
                renderData(allData);
            } else {
                const filtered = allData.filter(item => item.county === selected);
                renderData(filtered);
            }
        });

        // åˆå§‹åŒ–
        fetchData();
    </script>
</body>
</html>